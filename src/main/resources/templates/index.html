<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Rental Management System</title>

    <style>

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #f4f7f6; color: #333; padding: 20px; }


        header { background-color: #2c3e50; color: white; padding: 1rem; border-radius: 8px 8px 0 0; text-align: center; }
        h1 { font-size: 1.5rem; font-weight: 600; }
        h2 { margin-bottom: 15px; color: #2c3e50; border-bottom: 2px solid #ecf0f1; padding-bottom: 10px; }


        .tabs { display: flex; background-color: #34495e; border-radius: 0 0 8px 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tab-button { flex: 1; background: none; border: none; color: #bdc3c7; padding: 15px; cursor: pointer; font-size: 1rem; transition: all 0.3s; font-weight: 500; }
        .tab-button:hover { background-color: #2c3e50; color: white; }
        .tab-button.active { background-color: #3498db; color: white; font-weight: bold; }


        .tab-content { display: none; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }


        .form-card { background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; color: #555; }
        input, select { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; }


        .actions { margin-bottom: 15px; text-align: right; }
        .primary-btn { background-color: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 0.95rem; transition: background 0.3s; }
        .primary-btn:hover { background-color: #219150; }
        .full-width { width: 100%; margin-top: 10px; }
        .return-btn { background-color: #e67e22; }
        .return-btn:hover { background-color: #d35400; }

        /* Action buttons for Maintenance */
        .action-btn { padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; color: white; font-size: 0.8rem; margin-right: 5px; }

        /* --- Tables --- */
        .data-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .data-table th, .data-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        .data-table th { background-color: #ecf0f1; color: #2c3e50; font-weight: 600; }
        .data-table tr:hover { background-color: #f9f9f9; }

        /* --- Status Badges --- */
        .status { padding: 5px 10px; border-radius: 15px; font-size: 0.85rem; font-weight: bold; text-transform: uppercase; display: inline-block; }
        .status.available { background-color: #d4edda; color: #155724; }
        .status.active { background-color: #cce5ff; color: #004085; }
        .status.rented { background-color: #f8d7da; color: #721c24; }
        .status.completed { background-color: #d4edda; color: #155724; }
        .status.maintenance { background-color: #fff3cd; color: #856404; }

        /* --- Report Dashboard Cards --- */
        .summary-card { flex: 1; text-align: center; padding: 20px; border-radius: 8px; background: #f8f9fa; border: 1px solid #ddd; }
        .summary-num { font-size: 2rem; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

<header>
    <h1>Vehicle Rental System (V-RMS)</h1>
</header>

<div class="tabs">
    <button class="tab-button active" onclick="showTab('fleet')">1. Fleet Management</button>
    <button class="tab-button" onclick="showTab('booking')">2. Booking & Rental</button>
    <button class="tab-button" onclick="showTab('reports')">3. Reports</button>
</div>

<div id="fleet" class="tab-content active">
    <h2>üöó Fleet Management</h2>

    <div class="actions">
        <button class="primary-btn" onclick="toggleAddForm()">‚ûï Add New Vehicle</button>
    </div>

    <div id="addVehicleForm" style="display:none; background:#ecf0f1; padding:20px; border-radius:8px; margin-bottom:20px;">
        <h3>Add New Vehicle</h3>
        <form action="#" th:action="@{/addVehicle}" th:object="${newVehicle}" method="post" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div>
                <label>Type:</label>
                <select th:field="*{type}">
                    <option value="Car">Car</option>
                    <option value="Truck">Truck</option>
                    <option value="Motorcycle">Motorcycle</option>
                </select>
            </div>
            <div>
                <label>Make/Model:</label>
                <input type="text" th:field="*{makeModel}" placeholder="e.g. Honda Civic" required>
            </div>
            <div>
                <label>VIN:</label>
                <input type="text" th:field="*{vin}" placeholder="e.g. ABC-123" required>
            </div>
            <div>
                <label>Daily Rate ($):</label>
                <input type="number" step="0.01" th:field="*{dailyRate}" placeholder="45.00" required>
            </div>
            <div>
                <label>Status:</label>
                <select th:field="*{status}">
                    <option value="AVAILABLE">Available</option>
                    <option value="MAINTENANCE">In Maintenance</option>
                </select>
            </div>
            <div style="grid-column: span 2;">
                <button type="submit" class="primary-btn full-width">Save Vehicle</button>
            </div>
        </form>
    </div>

    <table class="data-table">
        <thead>
        <tr>
            <th>Type</th>
            <th>Make/Model</th>
            <th>Rate/Day</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="vehicle : ${vehicles}">
            <td th:text="${vehicle.type}">Car</td>
            <td th:text="${vehicle.makeModel} + ' (' + ${vehicle.vin} + ')'">Honda Civic</td>
            <td th:text="${'$' + vehicle.dailyRate}">$45.00</td>

            <td>
                <span th:classappend="${'status ' + #strings.toLowerCase(vehicle.status)}" th:text="${vehicle.status}">
                    AVAILABLE
                </span>
            </td>

            <td>
                <form th:if="${vehicle.status == 'MAINTENANCE'}" action="/vehicle/status" method="post" style="display:inline;">
                    <input type="hidden" name="id" th:value="${vehicle.id}">
                    <input type="hidden" name="status" value="AVAILABLE">
                    <button type="submit" class="action-btn" style="background-color: #27ae60;">
                        ‚úÖ Finish Repair
                    </button>
                </form>

                <form th:if="${vehicle.status == 'AVAILABLE'}" action="/vehicle/status" method="post" style="display:inline;">
                    <input type="hidden" name="id" th:value="${vehicle.id}">
                    <input type="hidden" name="status" value="MAINTENANCE">
                    <button type="submit" class="action-btn" style="background-color: #f39c12;">
                        üîß Service
                    </button>
                </form>

                <span th:if="${vehicle.status == 'RENTED'}" style="color: #999; font-size: 0.9rem;">
                    (Managed in Booking)
                </span>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div id="booking" class="tab-content">
    <h2>üìÖ Booking & Rental Processing</h2>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">

        <div class="form-card">
            <h3 style="color:#27ae60;">üöÄ New Rental Checkout</h3>
            <form action="/rent" method="post">
                <label>Customer Name/License:</label>
                <input type="text" name="customerName" placeholder="e.g. John Doe" required>

                <label>Select Available Vehicle:</label>
                <select name="vehicleId" required>
                    <option th:each="v : ${vehicles}"
                            th:if="${v.status == 'AVAILABLE'}"
                            th:value="${v.id}"
                            th:text="${v.makeModel} + ' - $' + ${v.dailyRate} + '/day'">
                    </option>
                </select>

                <label>Start Date:</label>
                <input type="date" name="startDate" required>

                <label>Expected End Date:</label>
                <input type="date" name="endDate" required>

                <button type="submit" class="primary-btn full-width">Confirm Rental</button>
            </form>
        </div>

        <div class="form-card">
            <h3 style="color:#e67e22;">üì• Return Vehicle</h3>
            <form action="/return" method="post">
                <label>Select Active Rental:</label>
                <select name="rentalId" required>
                    <option th:each="r : ${rentals}"
                            th:if="${r.status == 'ACTIVE'}"
                            th:value="${r.id}"
                            th:text="${r.vehicle.makeModel} + ' (Rented by: ' + ${r.customerName} + ')'">
                    </option>
                </select>

                <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                    * Total cost will be calculated automatically based on today's return date.
                </p>

                <button type="submit" class="primary-btn full-width return-btn">Process Return</button>
            </form>
        </div>
    </div>

    <h3>üìú Recent Rental History</h3>
    <table class="data-table">
        <thead>
        <tr>
            <th>Customer</th>
            <th>Vehicle</th>
            <th>Start Date</th>
            <th>Return Date</th>
            <th>Status</th>
            <th>Total Cost</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="rental : ${rentals}">
            <td th:text="${rental.customerName}">John Doe</td>
            <td th:text="${rental.vehicle.makeModel}">Honda Civic</td>
            <td th:text="${rental.startDate}">2023-10-01</td>
            <td th:text="${rental.returnDate != null ? rental.returnDate : '-'}">-</td>
            <td>
                <span th:classappend="${'status ' + #strings.toLowerCase(rental.status)}" th:text="${rental.status}">ACTIVE</span>
            </td>
            <td th:text="${rental.totalCost != null ? '$' + rental.totalCost : 'Calculating...'}">$0.00</td>
        </tr>
        </tbody>
    </table>
</div>

<div id="reports" class="tab-content">
    <h2>üìä Availability & Maintenance Reports</h2>

    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
        <div class="summary-card" style="border-left: 5px solid #2c3e50;">
            <h3>Total Fleet</h3>
            <p class="summary-num" th:text="${totalCount}">0</p>
        </div>
        <div class="summary-card" style="border-left: 5px solid #e74c3c;">
            <h3>Currently Rented</h3>
            <p class="summary-num" th:text="${rentedCount}">0</p>
        </div>
        <div class="summary-card" style="border-left: 5px solid #f1c40f;">
            <h3>‚ö†Ô∏è In Maintenance</h3>
            <p class="summary-num" th:text="${maintenanceCount}">0</p>
        </div>
    </div>

    <div class="report-filters" style="margin-bottom: 15px; background: #ecf0f1; padding: 10px; border-radius: 5px;">
        <label for="report-filter" style="display:inline; margin-right: 10px;">Filter View:</label>
        <select id="report-filter" onchange="filterReportTable()" style="display:inline; width: 200px; margin:0;">
            <option value="all">Show All Vehicles</option>
            <option value="RENTED">Rented</option>
            <option value="MAINTENANCE">In-Maintenance</option>
            <option value="AVAILABLE">Available</option>
        </select>
    </div>

    <table class="data-table">
        <thead>
        <tr>
            <th>Vehicle</th>
            <th>VIN</th>
            <th>Status</th>
            <th>Notes</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="v : ${vehicles}" class="report-row" th:data-status="${v.status}">
            <td th:text="${v.makeModel}">Honda Civic</td>
            <td th:text="${v.vin}">ABC-123</td>
            <td>
                <span th:classappend="${'status ' + #strings.toLowerCase(v.status)}" th:text="${v.status}">
                    RENTED
                </span>
            </td>
            <td>
                <span th:if="${v.status == 'RENTED'}">üöó Currently out with customer</span>
                <span th:if="${v.status == 'MAINTENANCE'}">üîß Needs Service</span>
                <span th:if="${v.status == 'AVAILABLE'}">‚úÖ Ready for rent</span>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script>

    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.target.classList.add('active');
    }


    function toggleAddForm() {
        var form = document.getElementById('addVehicleForm');
        form.style.display = (form.style.display === 'none') ? 'block' : 'none';
    }


    function filterReportTable() {
        var filter = document.getElementById("report-filter").value;
        var rows = document.querySelectorAll(".report-row");

        rows.forEach(row => {
            if (filter === "all" || row.getAttribute("data-status") === filter) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        });
    }
</script>
</body>
</html>