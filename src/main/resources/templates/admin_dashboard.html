<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        * { margin: 0; padding: 0; font-family: 'Poppins', sans-serif; box-sizing: border-box; }
        body { background: #f0f2f5; padding: 20px; }

        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); overflow: hidden; }

        header { background: #2c3e50; color: white; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; }
        .logout-btn { color: #e74c3c; background: white; padding: 8px 15px; border-radius: 20px; text-decoration: none; font-weight: bold; font-size: 0.9rem; transition: 0.3s; }
        .logout-btn:hover { background: #fceceb; }


        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; padding: 30px 40px 10px 40px; }
        .stat-card { background: #f8f9fa; padding: 20px; border-radius: 15px; text-align: center; border: 1px solid #eee; transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .stat-num { font-size: 2rem; font-weight: 700; margin: 10px 0; color: #2c3e50; }
        .stat-label { font-size: 0.9rem; color: #7f8c8d; text-transform: uppercase; letter-spacing: 1px; }

        .tabs { display: flex; background: white; padding: 0 40px; border-bottom: 1px solid #eee; margin-top: 20px; }
        .tab-btn { padding: 15px 25px; border: none; background: none; cursor: pointer; font-size: 1rem; color: #95a5a6; font-weight: 600; border-bottom: 3px solid transparent; transition: 0.3s; }
        .tab-btn.active { color: #3498db; border-bottom: 3px solid #3498db; }
        .tab-btn:hover { color: #3498db; }

        .content { padding: 40px; display: none; animation: fadeIn 0.4s; }
        .content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 20px; }
        th { background: #f8f9fa; color: #7f8c8d; padding: 15px; text-align: left; font-weight: 600; border-bottom: 2px solid #eee; }
        td { padding: 15px; border-bottom: 1px solid #eee; color: #2c3e50; }
        tr:last-child td { border-bottom: none; }

        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; color: white; font-size: 0.85rem; font-weight: 500; transition: 0.2s; }
        .approve { background: #2ecc71; } .approve:hover { background: #27ae60; }
        .reject { background: #e74c3c; } .reject:hover { background: #c0392b; }
        .view-img { color: #3498db; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 5px; }


        .glass-form { background: #f8f9fa; padding: 25px; border-radius: 15px; border: 1px solid #eee; margin-top: 20px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; outline: none; transition: 0.3s; }
        input:focus, select:focus { border-color: #3498db; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div style="display: flex; align-items: center; gap: 15px;">
            <i class="fas fa-shield-alt fa-2x"></i>
            <div>
                <h2 style="line-height: 1;">Admin Portal</h2>
                <span style="font-size: 0.8rem; opacity: 0.8;">Manager Dashboard</span>
            </div>
        </div>
        <a href="/logout" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </header>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Total Revenue</div>
            <div class="stat-num" style="color: #27ae60;" th:text="'$' + ${totalRevenue}">$0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Total Fleet</div>
            <div class="stat-num" th:text="${totalCount}">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Rented Out</div>
            <div class="stat-num" style="color: #e67e22;" th:text="${rentedCount}">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Pending Req</div>
            <div class="stat-num" style="color: #e74c3c;" th:text="${pendingRentals.size()}">0</div>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('requests')">üîî Requests</button>
        <button class="tab-btn" onclick="openTab('fleet')">üöó Fleet Management</button>
        <button class="tab-btn" onclick="openTab('returns')">üì• Process Returns</button>
    </div>

    <div id="requests" class="content active">
        <h3 style="margin-bottom: 20px; color: #34495e;">Incoming Booking Requests</h3>
        <table>
            <thead><tr><th>Customer Info</th><th>Vehicle</th><th>Period</th><th>License</th><th>Decision</th></tr></thead>
            <tbody>
            <tr th:each="r : ${pendingRentals}">
                <td>
                    <div th:text="${r.customerName}" style="font-weight:700; color:#2c3e50;"></div>
                    <div th:text="${r.customerPhone}" style="color:#95a5a6; font-size:0.85rem;"></div>
                </td>
                <td th:text="${r.vehicle.makeModel}"></td>
                <td th:text="${r.startDate} + ' ‚ûù ' + ${r.endDate}" style="font-size:0.9rem;"></td>
                <td>
                    <a th:if="${r.licenseImage != null}" th:href="@{'/uploads/' + ${r.licenseImage}}" target="_blank" class="view-img">
                        <i class="fas fa-id-card"></i> View ID
                    </a>
                    <span th:if="${r.licenseImage == null}" style="color:#bdc3c7;">No Upload</span>
                </td>
                <td style="display:flex; gap:10px;">
                    <form action="/admin/approve" method="post"><input type="hidden" name="rentalId" th:value="${r.id}"><button class="btn approve"><i class="fas fa-check"></i></button></form>
                    <form action="/admin/reject" method="post"><input type="hidden" name="rentalId" th:value="${r.id}"><button class="btn reject"><i class="fas fa-times"></i></button></form>
                </td>
            </tr>
            <tr th:if="${pendingRentals.empty}"><td colspan="5" style="text-align:center; padding:40px; color:#bdc3c7;">No pending requests at the moment.</td></tr>
            </tbody>
        </table>
    </div>

    <div id="fleet" class="content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
            <h3 style="color: #34495e;">Fleet Status</h3>
            <button onclick="toggleForm()" class="btn approve" style="background:#3498db;">+ Add New Vehicle</button>
        </div>

        <div id="addForm" class="glass-form" style="display:none;">
            <form action="/admin/addVehicle" method="post">
                <div class="form-row">
                    <input type="text" name="makeModel" placeholder="Vehicle Make & Model" required>
                    <input type="text" name="vin" placeholder="License Plate / VIN" required>
                </div>
                <div class="form-row">
                    <input type="number" name="dailyRate" placeholder="Daily Rate ($)" required>
                    <select name="status">
                        <option value="AVAILABLE">‚úÖ Available</option>
                        <option value="MAINTENANCE">‚ö†Ô∏è Maintenance</option>
                    </select>
                </div>
                <button type="submit" class="btn approve" style="width: 100%;">Save to Fleet</button>
            </form>
        </div>

        <table>
            <thead><tr><th>Vehicle</th><th>License Plate</th><th>Rate/Day</th><th>Status</th><th>Quick Action</th></tr></thead>
            <tbody>
            <tr th:each="v : ${vehicles}">
                <td th:text="${v.makeModel}" style="font-weight: 600;"></td>
                <td th:text="${v.vin}"></td>
                <td th:text="'$' + ${v.dailyRate}"></td>
                <td>
                    <span th:if="${v.status == 'AVAILABLE'}" style="background:#e8f8f5; color:#27ae60; padding:5px 10px; border-radius:15px; font-size:0.8rem; font-weight:700;">AVAILABLE</span>
                    <span th:if="${v.status == 'RENTED'}" style="background:#fdedec; color:#e74c3c; padding:5px 10px; border-radius:15px; font-size:0.8rem; font-weight:700;">RENTED</span>
                    <span th:if="${v.status == 'MAINTENANCE'}" style="background:#fef9e7; color:#f1c40f; padding:5px 10px; border-radius:15px; font-size:0.8rem; font-weight:700;">MAINTENANCE</span>
                </td>
                <td>
                    <form th:if="${v.status == 'MAINTENANCE'}" action="/admin/vehicle/status" method="post"><input type="hidden" name="id" th:value="${v.id}"><input type="hidden" name="status" value="AVAILABLE"><button class="btn approve">Finish Repair</button></form>
                    <form th:if="${v.status == 'AVAILABLE'}" action="/admin/vehicle/status" method="post"><input type="hidden" name="id" th:value="${v.id}"><input type="hidden" name="status" value="MAINTENANCE"><button class="btn reject" style="background:#f39c12;">Service</button></form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div id="returns" class="content">
        <h3 style="margin-bottom: 20px; color: #34495e;">Return Processing</h3>
        <div class="glass-form">
            <form action="/admin/return" method="post">
                <label style="display:block; margin-bottom:10px; font-weight:600; color:#555;">Select Active Rental:</label>
                <select name="rentalId" required style="margin-bottom: 20px;">
                    <option value="" disabled selected>Choose customer to return car...</option>
                    <option th:each="r : ${activeRentals}" th:value="${r.id}" th:text="${r.customerName} + ' | ' + ${r.vehicle.makeModel} + ' (Due: ' + ${r.endDate} + ')'"></option>
                </select>
                <button type="submit" class="btn approve" style="width:100%; padding: 15px; font-size: 1rem;">Confirm Return & Calculate Final Cost</button>
            </form>
        </div>
    </div>
</div>

<script th:if="${message}">
    Swal.fire({
        title: 'Transaction Complete!',
        text: "[[${message}]]",
        icon: 'success',
        confirmButtonColor: '#3498db',
        confirmButtonText: 'Great!'
    });
</script>

<script>
    function openTab(tabName) {
        var i;
        var x = document.getElementsByClassName("content");
        var tabs = document.getElementsByClassName("tab-btn");
        for (i = 0; i < x.length; i++) { x[i].classList.remove("active"); x[i].style.display = "none"; }
        for (i = 0; i < tabs.length; i++) { tabs[i].classList.remove("active"); }
        document.getElementById(tabName).style.display = "block";
        document.getElementById(tabName).classList.add("active");
        event.currentTarget.classList.add("active");
    }
    function toggleForm() {
        var form = document.getElementById('addForm');
        form.style.display = (form.style.display === 'none' || form.style.display === '') ? 'block' : 'none';
    }
</script>

</body>
</html>

